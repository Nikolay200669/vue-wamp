/*!
 * vue-wamp v2.0.1
 * https://github.com/lajosbencz/vue-wamp#readme
 * Released under the MIT License.
 */(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("autobahn")):"function"==typeof define&&define.amd?define(["autobahn"],b):(a=a||self,a.VueWamp=b(a.autobahn))})(this,function(a){"use strict";var n=Math.min;function b(a,b){return b={exports:{}},a(b,b.exports),b.exports}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&i(a,b)}function h(a){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},h(a)}function i(a,b){return i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},i(a,b)}function j(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function k(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:j(a)}function l(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=h(a),null!==a););return a}function m(a,b,c){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=l(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},m(a,b,c||a)}a=a&&a.hasOwnProperty("default")?a["default"]:a;var o=b(function(a){var b=a.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=b)}),p=b(function(a){var b=a.exports={version:"2.6.3"};"number"==typeof __e&&(__e=b)}),q=p.version,r=function(a){return"object"==typeof a?null!==a:"function"==typeof a},s=function(a){if(!r(a))throw TypeError(a+" is not an object!");return a},t=function(a){try{return!!a()}catch(a){return!0}},u=!t(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),v=o.document,w=r(v)&&r(v.createElement),x=function(a){return w?v.createElement(a):{}},y=!u&&!t(function(){return 7!=Object.defineProperty(x("div"),"a",{get:function(){return 7}}).a}),z=function(a,b){if(!r(a))return a;var c,d;if(b&&"function"==typeof(c=a.toString)&&!r(d=c.call(a)))return d;if("function"==typeof(c=a.valueOf)&&!r(d=c.call(a)))return d;if(!b&&"function"==typeof(c=a.toString)&&!r(d=c.call(a)))return d;throw TypeError("Can't convert object to primitive value")},A=Object.defineProperty,B=u?Object.defineProperty:function(a,b,c){if(s(a),b=z(b,!0),s(c),y)try{return A(a,b,c)}catch(a){}if("get"in c||"set"in c)throw TypeError("Accessors not supported!");return"value"in c&&(a[b]=c.value),a},f={f:B},C=function(a,b){return{enumerable:!(1&a),configurable:!(2&a),writable:!(4&a),value:b}},D=u?function(a,b,c){return f.f(a,b,C(1,c))}:function(a,b,c){return a[b]=c,a},E={}.hasOwnProperty,F=function(a,b){return E.call(a,b)},G=0,H=Math.random(),I=function(a){return"Symbol(".concat(a===void 0?"":a,")_",(++G+H).toString(36))},J=b(function(a){var b=I("src"),c="toString",d=Function[c],e=(""+d).split(c);p.inspectSource=function(a){return d.call(a)},(a.exports=function(a,c,d,f){var g="function"==typeof d;g&&(F(d,"name")||D(d,"name",c));a[c]===d||(g&&(F(d,b)||D(d,b,a[c]?""+a[c]:e.join(c+""))),a===o?a[c]=d:f?a[c]?a[c]=d:D(a,c,d):(delete a[c],D(a,c,d)))})(Function.prototype,c,function(){return"function"==typeof this&&this[b]||d.call(this)})}),K=function(a){if("function"!=typeof a)throw TypeError(a+" is not a function!");return a},L=function(d,e,f){return(K(d),void 0===e)?d:1===f?function(b){return d.call(e,b)}:2===f?function(c,a){return d.call(e,c,a)}:3===f?function(f,a,b){return d.call(e,f,a,b)}:function(){return d.apply(e,arguments)}},M="prototype",N=function(a,b,c){var d,e,f,g,h=a&N.F,i=a&N.G,j=a&N.S,k=a&N.P,l=a&N.B,m=i?o:j?o[b]||(o[b]={}):(o[b]||{})[M],n=i?p:p[b]||(p[b]={}),q=n[M]||(n[M]={});for(d in i&&(c=b),c)e=!h&&m&&void 0!==m[d],f=(e?m:c)[d],g=l&&e?L(f,o):k&&"function"==typeof f?L(Function.call,f):f,m&&J(m,d,f,a&N.U),n[d]!=f&&D(n,d,g),k&&q[d]!=f&&(q[d]=f)};o.core=p,N.F=1,N.G=2,N.S=4,N.P=8,N.B=16,N.W=32,N.U=64,N.R=128;var O=N,P={}.toString,Q=function(a){return P.call(a).slice(8,-1)},R=Object("z").propertyIsEnumerable(0)?Object:function(a){return"String"==Q(a)?a.split(""):Object(a)},S=function(a){if(a==null)throw TypeError("Can't call method on  "+a);return a},T=function(a){return R(S(a))},U=Math.ceil,V=Math.floor,W=function(a){return isNaN(a=+a)?0:(0<a?V:U)(a)},X=function(a){return 0<a?n(W(a),9007199254740991):0},Y=Math.max,Z=function(a,b){return a=W(a),0>a?Y(a+b,0):n(a,b)},$=b(function(a){var b=o["__core-js_shared__"]||(o["__core-js_shared__"]={});(a.exports=function(a,c){return b[a]||(b[a]=c===void 0?{}:c)})("versions",[]).push({version:p.version,mode:"global",copyright:"\xA9 2019 Denis Pushkarev (zloirock.ru)"})}),_=$("keys"),aa=function(a){return function(b,c,d){var e,f=T(b),g=X(f.length),h=Z(d,g);if(a&&c!=c){for(;g>h;)if(e=f[h++],e!=e)return!0;}else for(;g>h;h++)if((a||h in f)&&f[h]===c)return a||h||0;return!a&&-1}}(!1),ba=function(a){return _[a]||(_[a]=I(a))}("IE_PROTO"),ca=function(a,b){var c,d=T(a),e=0,f=[];for(c in d)c!=ba&&F(d,c)&&f.push(c);for(;b.length>e;)F(d,c=b[e++])&&(~aa(f,c)||f.push(c));return f},da=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ea=Object.keys||function(a){return ca(a,da)},fa=Object.getOwnPropertySymbols,ga={f:fa},ha={}.propertyIsEnumerable,ia={f:ha},ja=function(a){return Object(S(a))},ka=Object.assign,la=!ka||t(function(){var a={},b={},c=Symbol(),d="abcdefghijklmnopqrst";return a[c]=7,d.split("").forEach(function(a){b[a]=a}),7!=ka({},a)[c]||Object.keys(ka({},b)).join("")!=d})?function(a){for(var b=ja(a),c=arguments.length,d=1,e=ga.f,f=ia.f;c>d;)for(var g,h=R(arguments[d++]),i=e?ea(h).concat(e(h)):ea(h),k=i.length,l=0;k>l;)f.call(h,g=i[l++])&&(b[g]=h[g]);return b}:ka;O(O.S+O.F,"Object",{assign:la});var ma=f.f,na=Function.prototype,oa=/^\s*function ([^ (]*)/,pa="name";pa in na||u&&ma(na,pa,{configurable:!0,get:function(){try{return(""+this).match(oa)[1]}catch(a){return""}}});var qa={name:"vue-wamp",version:"2.0.2",description:"WAMP protocol wrapper library for Vue",private:!1,main:"dist/vue-wamp.cjs.js",module:"dist/vue-wamp.esm.js",browser:"dist/vue-wamp.js",jsdelivr:"dist/vue-wamp.min.js",scripts:{build:"node build/build.js","example:router":"cd example/router && crossbar start","example:server":"node example/server.js",test:"echo \"Error: no test specified\" && exit 1"},repository:{type:"git",url:"git+https://github.com/lajosbencz/vue-wamp"},keywords:["vue","wamp","autobahn","websocket"],author:"Lajos Bencz <lazos@lazos.me>",license:"MIT",bugs:{url:"https://github.com/lajosbencz/vue-wamp/issues"},homepage:"https://github.com/lajosbencz/vue-wamp#readme",peerDependencies:{autobahn:"*",vue:"*"},devDependencies:{"@babel/plugin-external-helpers":"^7.2.0","@babel/plugin-transform-parameters":"^7.2.0","@babel/preset-env":"^7.3.1","@babel/polyfill":"^7.2.5",autobahn:"^18.10.2",rollup:"^1.1.2","rollup-plugin-babel":"^4.3.2","rollup-plugin-babel-minify":"^7.0.0","rollup-plugin-commonjs":"^9.2.0","rollup-plugin-json":"^3.1.0","rollup-plugin-node-resolve":"^4.0.0","rollup-plugin-replace":"^2.1.0"}},ra=function(){function a(b){c(this,a),this._con=b,this._reconnectors=[],this._subscriptions=[],this._registrations=[]}return e(a,[{key:"subscribe",value:function(a,b,c){var d=this;c=c||{},c.acknowledge=!0,this._reconnectors.push(function(){d._con.subscribe(a,b,c).then(function(a){return d._subscriptions.push(a)}).catch(console.error)})}},{key:"register",value:function(a,b,c){var d=this;c=c||{},c.acknowledge=!0,this._reconnectors.push(function(){d._con.register(a,b,c).then(function(a){return d._registrations.push(a)}).catch(console.error)})}},{key:"unsubscribe",value:function(a){for(var b in this._subscriptions)if(this._subscriptions.hasOwnProperty(b)){var c=this._subscriptions[b];c===a&&(this._subscriptions=this._subscriptions.splice(b,1))}}},{key:"unregister",value:function(a){for(var b in this._registrations)if(this._registrations.hasOwnProperty(b)){var c=this._registrations[b];c===a&&(this._registrations=this._registrations.splice(b,1))}}},{key:"clear",value:function(){this._reconnectors=[]}},{key:"reconnected",value:function(){for(var a in this._reconnectors){var b=this._reconnectors[a];b()}}},{key:"closed",value:function(){for(;0<this._subscriptions.length;){var a=this._subscriptions.shift();this._con.unsubscribe(a).catch(function(){})}for(;0<this._registrations.length;){var b=this._registrations.shift();this._con.unregister(b).catch(function(){})}}}]),a}(),sa=function(){function a(b,d,e){var f=this;c(this,a),this._con=b,this._ctx=d,this._persist=new ra(b,e),e.$on("reconnected",function(){f._persist.reconnected()}),e.$on("closed",function(){f.closed(),f._persist.closed()}),this._subscriptions=[],this._registrations=[]}return e(a,[{key:"open",value:function(){return this._con.open()}},{key:"close",value:function(a,b){return this._con.close(a,b)}},{key:"call",value:function(a,b,c,d){return this._con.call(a,b,c,d)}},{key:"subscribe",value:function(a,b,c){var e=this;c=c||{},c.acknowledge=!0;var f=this._con.defer();return this._con.subscribe(a,b,c).then(function(a){e._subscriptions.push(a),f.resolve(a)},f.reject),this._persist.subscribe(a,b,c),f.promise}},{key:"register",value:function(a,b,c){var e=this;c=c||{},c.acknowledge=!0;var f=this._con.defer();return this._con.register(a,b,c).then(function(a){e._registrations.push(a),f.resolve(a)},f.reject),this._persist.register(a,b,c),f.promise}},{key:"publish",value:function(a,b,c,d){return this._con.publish(a,b,c,d)}},{key:"unsubscribe",value:function(a){for(var b in this._subscriptions)if(this._subscriptions.hasOwnProperty(b)){var c=this._subscriptions[b];c===a&&(this._subscriptions=this._subscriptions.splice(b,1))}return this._persist.unsubscribe(a),this._con.unsubscribe(a)}},{key:"unregister",value:function(a){for(var b in this._registrations)if(this._registrations.hasOwnProperty(b)){var c=this._registrations[b];c===a&&(this._registrations=this._registrations.splice(b,1))}return this._persist.unregister(a),this._con.unregister(a)}},{key:"closed",value:function(){for(;0<this._subscriptions.length;){var a=this._subscriptions.shift();this._con.unsubscribe(a).catch(function(){})}for(;0<this._registrations.length;){var b=this._registrations.shift();this._con.unregister(b).catch(function(){})}}},{key:"destroy",value:function(){this.closed(),this._persist.closed(),this._persist.clear()}},{key:"isConnected",get:function(){return this._con.isConnected}},{key:"isOpen",get:function(){return this._con.isOpen}},{key:"isRetrying",get:function(){return this._con.isRetrying}}]),a}(),ta="["+qa.name+"]",ua={log:function(){},info:function(){},warn:function(){},error:function(){}},va={log:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).log.apply(b,[ta].concat(d))},info:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).info.apply(b,[ta].concat(d))},warn:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).warn.apply(b,[ta].concat(d))},error:function(){for(var b,c=arguments.length,d=Array(c),a=0;a<c;a++)d[a]=arguments[a];(b=console).error.apply(b,[ta].concat(d))}},wa={debug:!1},xa=function(a){function b(a,d){var f;c(this,b),a=Object.assign({},wa,a),f=k(this,h(b).call(this,a)),f._vueWampEvents=d,f._vueWampCfg=a,f._vueWampQRes=[],f._vueWampQRej=[];var g={isConnected:!1,isOpen:!1,isRetrying:!1},i=function(a){var b={isConnected:f.isConnected,isOpen:f.isOpen,isRetrying:f.isRetrying},c={status:b,lastStatus:g,details:a};f.log.info("Status emit",c),d.$emit("status",c),b.isOpen&&!g.isOpen?(d.$emit("opened",c),!b.isRetrying&&g.isRetrying&&d.$emit("reconnected",c)):!b.isOpen&&g.isOpen&&d.$emit("closed",c),b.isRetrying&&!g.isRetrying&&d.$emit("retrying",c),g=b};return f.onopen=function(b,c){f.log.info("Connection opened",{session:b,details:c}),i(c);for(var d,e=f._vueWampQRes.length;0<f._vueWampQRes.length;)d=f._vueWampQRes.shift(),d(b);f.log.info("Sessions resolved:",e),f._vueWampQRej=[],a.hasOwnProperty("onopen")&&"function"==typeof a.onopen&&a.onopen(b,c)},f.onclose=function(b,c){f.log.info("Connection closed",{reason:b,details:c});var d=!1;c.will_retry||(f._autoreconnect_reset(),d=!0),i(c);for(var e,g=f._vueWampQRej.length;0<f._vueWampQRej.length;)e=f._vueWampQRej.shift(),e({reason:b,details:c});return f.log.info("Sessions rejected:",g),f._vueWampQRes=[],a.hasOwnProperty("onclose")&&"function"==typeof a.onclose&&a.onclose(session,c),d},f.log.info("Connection create",{Connection:j(j(f))}),i(null),f}return g(b,a),e(b,[{key:"withContext",value:function(a){return new sa(this,a,this._vueWampEvents)}},{key:"open",value:function(){this.log.info("Connection open",{Connection:this}),m(h(b.prototype),"open",this).call(this)}},{key:"close",value:function(a,c){this.log.info("Connection close",{Connection:this,reason:a,message:c}),m(h(b.prototype),"close",this).call(this,a,c)}},{key:"call",value:function(a,b,c,e){b=b||[],c=c||{},e=e||{},this.log.info("CALL",{procedure:a,args:b,kwargs:c,options:e});var f=this.defer();return this.sessionPromise.then(function(d){return d.call(a,b,c,e).then(f.resolve,f.reject,f.notify)}).catch(f.reject),f.promise}},{key:"publish",value:function(a,b,c,e){b=b||[],c=c||{},e=e||{},e.acknowledge=!0,this.log.info("PUBLISH",{topic:a,args:b,kwargs:c,options:e});var f=this.defer();return this.sessionPromise.then(function(d){return d.publish(a,b,c,e).then(f.resolve,f.reject)}).catch(f.reject),f.promise}},{key:"register",value:function(a,b,c){c=c||{},c.acknowledge=!0,this.log.info("REGISTER",{procedure:a,endpoint:b,options:c});var e=this.defer();return this.sessionPromise.then(function(d){return d.register(a,b,c).then(e.resolve,e.reject)}).catch(e.reject),e.promise}},{key:"subscribe",value:function(a,b,c){c=c||{},this.log.info("SUBSCRIBE",{topic:a,handler:b,options:c});var e=this.defer();return this.sessionPromise.then(function(d){return d.subscribe(a,b,c).then(e.resolve,e.reject)}).catch(e.reject),e.promise}},{key:"unregister",value:function(a){this.log.info("UNREGISTER",a);var b=this.defer();return this.sessionPromise.then(function(c){return c.unregister(a).then(b.resolve,b.reject)}).catch(b.reject),b.promise}},{key:"unsubscribe",value:function(a){this.log.info("UNSUBSCRIBE",a);var b=this.defer();return this.sessionPromise.then(function(c){return c.unsubscribe(a).then(b.resolve,b.reject)}).catch(b.reject),b.promise}},{key:"version",get:function(){return qa.version}},{key:"log",get:function(){return this._vueWampCfg.debug?va:ua}},{key:"sessionPromise",get:function(){var a=this.defer();return this.isOpen&&this.session?a.resolve(this.session):(this.open(),this._vueWampQRes.push(a.resolve),this._vueWampQRej.push(a.reject)),a.promise}}]),b}(a.Connection);return function(a,b){var c=new a,d=new xa(b,c);a.Wamp=d,Object.defineProperties(a.prototype,{$wamp:{get:function(){return this._vueWampWithContext||(this._vueWampWithContext=d.withContext(this)),this._vueWampWithContext}}}),a.mixin({data:function(){return{wampIsConnected:!1,wampIsOpen:!1,wampIsRetrying:!1}},created:function(){var a=this;if(this===this.$root&&(c.$on("status",function(b){a.wampIsConnected=b.status.isConnected,a.wampIsOpen=b.status.isOpen,a.wampIsRetrying=b.status.isRetrying,a.$emit("$wamp.status",b)}),c.$on("opened",function(b){return a.$emit("$wamp.opened",b)}),c.$on("closed",function(b){return a.$emit("$wamp.closed",b)}),c.$on("retrying",function(b){return a.$emit("$wamp.retrying",b)}),c.$on("reconnected",function(b){return a.$emit("$wamp.reconnected",b)})),!!this.$options.wamp){var b=["subscribe","register"],e=this.$options.wamp,f=function(c){c=b[c];var f=e[c],h=function(b){if(!f.hasOwnProperty(b))return"continue";var e=f[b],g=void 0,h={acknowledge:!0};if("function"==typeof e?g=e:(g=e.handler,h=Object.assign(h,e),delete h.handler),"function"!=typeof e)throw"vue-wamp handler must be callable";a.$wamp[c](b,g.bind(a),h).then(function(a){return d.log.info("Component option: "+c+" "+b,a)}).catch(d.log.error)};for(var i in f){var j=h(i)}g=c};for(var g in b)f(g)}},beforeDestroy:function(){this.$wamp.destroy()}})}});
//# sourceMappingURL=vue-wamp.js.map
